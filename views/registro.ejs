<!DOCTYPE html>
<html lang="es">
<!-- head -->
<%- include("partials/head")  %> 
<!-- fin head-->
<body>
<!-- header -->

<%- include("partials/header")  %> 
<!-- fin header  -->

    <main class="main">
        <form id="form" action="/users/agregarUser/" method="POST" enctype="multipart/form-data"><!-- debo poner enctype para que suba el archivo -->
            <div class="container-register">
                <div class="welcome">
                    <h3>¡Bienvenido!</h3>
                    <p class="subTitle">Creá tu cuenta para comprar con mas facilidad</p>
                </div>
                <div class="exterior">
                    <div class="my-data">
                        <p class="complete">Completá tus datos</p>
                        <section class="section1">
                            <div class="name">
                                <div class="left-side">
                                    <label class="nameLabel" for="">Nombre</label>
                                    <input class="input" type="text" name="name" id="">
                                </div>
                                <div class="right-side">
                                    <label class="nameLabel" for="" id="lana">Apellido</label>
                                    <input class="input" type="text" name="last-name" id="lastName">
                                </div>                   
                                <div class="left-side">
                                    <label class="nameLabel" for="">Dirección</label>
                                    <input class="input" type="adress" name="adress">
                                </div>
                                <div class="right-side">
                                    <label class="nameLabel" for="" >Teléfono</label>
                                    <input class="input" type="number" name="phone" >
                                </div>                   
                            </div>            
                            
                        </section>
                        
                        <section class="section2">
                            <label class="midle "for="">Correo Electrónico</label>
                            <input class="midle input"type="email" name="email" placeholder="mail@domain.com">
                            <label class="midle "for="">Contraseña</label>
                            <div class="pass1">
                                <input type="password" class="input" onclick="validateOff()" name="pass" id="myInput">
                                <i class="far fa-eye"  onclick="myFunction()" id="eye1"></i>
                            </div>
                            <label class="midle"for="">Confirmar contraseña</label>
                            <div class="pass2">                                    
                                <input type="password" class="input" onblur ="validate()" onclick="validateOff()" name="" id="myInput2">
                                <i class="far fa-eye"  onclick="myFunction2()" id="eye2"></i>
                            </div>  
                            <div class="validate" id="validate">
                                <span class="val">¡Las contraseñas no coinciden!</span>
                            </div>
                        </section>
                        <section class="section3">
                            <div class="images" id="imagePreview" >
                                <img id="old" src="/image/userAvatars/avatar.png " alt="">
                            </div>
                            <div class="inputMask bordeColor">
                                <input class="inputOut" type="file" id="examinar" name="avatar"> <!-- este nombre va en el metodo post al cargar en multer -->
                                Elija una Imagen
                            </div> 
                            <p id="errorImage"></p>
    
                            
                        </section>
                        
                                    
                    </div>
                </div> 
                
                <button class="register-button"  id="button" type="submit">Registrarse</button>
                        <div class="login-cont">
                            <a class="ingresa" href="/login">
                                ¿Ya tenés cuenta? Ingresá
                            </a>
                        </div>              
            </div>
        </form>
        
    
    <script>
    var button = document.getElementById("button")
    function validateOff(){
        let mesage = document.getElementById("validate");
        mesage.style.display="none";
        button.style.display = "none"
    }
    function myFunction() {
        let x = document.getElementById("myInput");      
          
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }           
    }    
    function myFunction2() {
        let x = document.getElementById("myInput2");
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }
    }
    function validate(){
        let vali1 = document.getElementById("myInput");
        let vali2 = document.getElementById("myInput2");
        let mesage = document.getElementById("validate")
        
        let form = document.getElementById("form")
        if (vali1.value !== vali2.value){
            mesage.style.display ="flex"
            
        }else{
            button.style.display = "initial"
        }
    }
    let inputImage = document.getElementById('examinar')
inputImage.addEventListener('change', 
function fileValidation(){
    var errorImage = document.getElementById('errorImage')
    var filePath = inputImage.value; //Capturo el valor del input
    var allowefExtensions = /(.jpg|.jpeg|.png|.gif)$/i; //Extensiones permitidas
    if(!allowefExtensions.exec(filePath)){ //El método exec() ejecuta una busqueda sobre las coincidencias de una expresión regular en una cadena especifica. Devuelve el resultado como array, o null.
        let error = 'La imagen no es válida, usá extensiones (.jpg - .jpeg - .png - .gif)'
        errorImage.innerHTML = error;
        inputImage.value = '';
        document.getElementById('imagePreview').innerHTML = '<img src="/image/userAvatars/avatar.png"/>'; //mantengo la imagen po default
        return false;
    }else{
        // Image preview
        if(inputImage.files && inputImage.files[0]){
            var reader = new FileReader();
            reader.onload = function(e){
                document.getElementById('imagePreview').innerHTML = '<img src="' + e.target.result +'"/>';
            };
            reader.readAsDataURL(inputImage.files[0]);
            errorImage.innerHTML = '';
        }
    }
})
    
    </script> 
<!-- footer -->

<!-- fin footer  -->
</body>
<!-- footer -->
<%- include("partials/footer")  %> 
</html>